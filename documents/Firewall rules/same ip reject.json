{
    "trigger": {
        "schedule": {
            "interval": "1m"
        }
    },
    "input": {
        "search": {
            "request": {
                "body": {
                    "size": 0,
                    "query": {
                        "bool": {
                            "must": [{
                                    "match": {
                                        "action": "REJECT"
                                    }
                                },
                                {
                                    "match": {
                                        "path": "RECEIVE"
                                    }
                                }
                            ],
                            "filter": [{
                                "range": {
                                    "@timestamp": {
                                        "gte": "now-30m"
                                    }
                                }
                            }]
                        }
                    },
                    "aggs": {
                        "group_by_src_ip": {
                            "terms": {
                                "field": "src-ip",
                                "size": 100
                            }
                        }
                    },
                    "_source": ["src-ip"]
                },
                "indices": [
                    "filebeat-*"
                ]
            }
        }
    },
    "condition": {
        "array_compare": {
            "ctx.payload.aggregations.group_by_src_ip.buckets": {
                "path": "doc_count",
                "gte": {
                    "value": 100
                }
            }
        }
    },
    "actions": {
        "my-logging-action": {
            "logging": {
                "text": "There are more than 100 (exactly: {{ctx.payload.aggregations.group_by_src_ip.buckets.doc_count}} REJECTS FROM IP ADDRESS {{ctx.payload.aggregations.group_by_src_ip.buckets.key}}"
            }
        }
    }
}